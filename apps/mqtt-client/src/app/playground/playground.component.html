<ul>
  <li>ESP_12974077/movement</li>
  <li>devices/ESP_12974077/temp, 18.90</li>
  <li>devices/ESP_12974077/hum, 56.6</li>
  <li>devices/ESP_12974077/dht, {{'{'}}"temperature":18.9,"humidity":56.6}</li>
  <li>devices/ESP_12974077/voltage, 3.18</li>
</ul>
<mat-form-field>
  <mat-label>MQTT Topic</mat-label>
  <input matInput placeholder="devices/ESP_12974077/dht" [formControl]="topic">
</mat-form-field>
<br/>
<mat-form-field>
  <mat-label>MQTT Payload (e.g. JSON)</mat-label>
  <input matInput placeholder="{temperature: 33.1, humidity: 58.2}" [formControl]="payload">
</mat-form-field>
<br/>
<button mat-raised-button color="primary" (click)="sendMessage()">
  <mat-icon>send</mat-icon>
  Send MQTT message
</button>
<br/>
<br/>

<h2>ESP_12974077</h2>
<div>
  Batterie: {{latestVoltage$ | async}}V
</div>
<div *ngIf="latestTemperature$ | async as temp">
  Temperatur: {{temp.temperature}} {{temp.trend}}
</div>

<h2>DHT</h2>
<div *ngIf="dhtLog$ | async as dhtLog" style="width: 100%; height: 200px; overflow-y: auto;">
  <div *ngFor="let x of dhtLog">
    {{x.time | date:'dd.MM.yyyy HH:mm:ss'}}: {{x.temperature}} Â°C, {{x.humidity}}%
  </div>
</div>

<h2>Logs</h2>
<div *ngIf="systemLog$ | async as systemLog" style="width: 100%; height: 200px; overflow-y: auto;">
  <div *ngFor="let x of systemLog">
    {{x.time | date:'dd.MM.yyyy HH:mm:ss'}}: {{x.message}}
  </div>
</div>

<h2>Movements</h2>
<div *ngIf="movementLog$ | async as movementLog" style="width: 100%; height: 200px; overflow-y: auto;">
  <div *ngFor="let x of movementLog">
    {{x.time | date:'dd.MM.yyyy HH:mm:ss'}}: {{x.message}}
  </div>
</div>

<br/>
<br/>

<mat-form-field *ngIf="espRepos$ | async as repos">
  <mat-label>Firmware</mat-label>
  <mat-select [formControl]="libName">
    <mat-option *ngFor="let repo of repos" [value]="repo">{{repo}}</mat-option>
  </mat-select>
</mat-form-field>
<mat-form-field>
  <mat-label>Release</mat-label>
  <mat-select [formControl]="releaseType">
    <mat-option value="major">major (1.0.1 => 2.0.0)</mat-option>
    <mat-option value="minor">minor (1.0.1 => 1.1.0)</mat-option>
    <mat-option value="patch">patch (1.0.1 => 1.0.2)</mat-option>
  </mat-select>
</mat-form-field>
<mat-form-field *ngIf="espConfig$ | async as esps">
  <mat-label>ESPs</mat-label>
  <mat-select multiple [formControl]="chipIds">
    <mat-option *ngFor="let esp of esps" [value]="esp.chipId">{{esp.chipId}} ({{esp.description}}, {{esp.model}})</mat-option>
  </mat-select>
</mat-form-field>
<br/>
<button mat-raised-button color="primary" (click)="triggerPioBuild()">
  <mat-icon>play_arrow</mat-icon>
  Trigger PIO Build
</button>
<button mat-button (click)="killPioBuild()">
  <mat-icon>stop</mat-icon>
  Kill active PIO Build
</button>
<br/>
<textarea *ngIf="logMessages$ | async as logMessages" style="width: 100%; height: 400px;">
  {{ logMessages }}
</textarea>

<br/>
<br/>

<button mat-raised-button color="primary" (click)="getCommutingHistory()">Get Commuting History</button>

<br/>
<br/>

<div *ngIf="rooms$ | async as rooms" cdkDropListGroup class="floor" style="background-color: #ccc; position: relative; width: 550px; height: 600px;">
  <div
    *ngFor="let room of rooms"
    class="room"
    style="position: absolute; border: 2px solid #000; background-color: lightblue;"
    [style.width.px]="room.width"
    [style.height.px]="room.height"
    [style.left.px]="room.position.x"
    [style.top.px]="room.position.y"
    cdkDropList
    [cdkDropListData]="room"
    cdkDropListSortingDisabled="true"
    (cdkDropListDropped)="drop($event)"
  >
    <span style="position: absolute;">{{room.name}}</span>
    <div *ngFor="let sensor of sensors$ | async | filter:{roomId:room._id}">
      <mat-icon
        class="sensor"
        [style.left.px]="sensor.position?.x"
        [style.top.px]="sensor.position?.y"
        [cdkDragData]="sensor"
        cdkDrag
        [matMenuTriggerFor]="menu"
      >{{getIconName(sensor.type)}}</mat-icon>
      <mat-menu #menu="matMenu">
        <p>{{sensor._id}}</p>
        <button mat-menu-item (click)="removeFromRoom(sensor)">Aus Raum entfernen</button>
      </mat-menu>
    </div>
  </div>

  <div
    id="unassigned-list"
    style="position: absolute; right: -50px; width: 50px; height: 200px; background: lightgreen; border: 2px solid #000"
    cdkDropList
    cdkDropListSortingDisabled="true"
    (cdkDropListDropped)="drop($event)"
  >
    <div *ngFor="let sensor of unassignedSensors$ | async">
      <mat-icon
        class="sensor"
        [cdkDragData]="sensor"
        cdkDrag
        [matMenuTriggerFor]="menu"
      >{{getIconName(sensor.type)}}</mat-icon>
      <mat-menu #menu="matMenu">
        <p>{{sensor._id}}</p>
      </mat-menu>
  </div>
</div>